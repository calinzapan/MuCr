<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>LogIn - Music Collector</title>
    <link rel="icon" type="image/png" sizes="192x192" href="/img/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/css/forms.css">
</head>
<body>
<div class="overlay"></div>
<div class="shadow-overlay"></div>
<div class="header">
    <div class="formbox">
        <div class="logo">
            <img src="/img/logo.png" alt="Homepage">
        </div>
        <form id='login'>
            <p>Email Address</p>
            <input id='email' type="email" name="email" placeholder="Enter Email Address" required>
            <p>Password</p>
            <input id='password' type="password" name="password" placeholder="Enter Password" required>
            <div id="msg" class="message"> Allow only ascii characters to be sent.</div>
            <input type="submit" value="Login">
            <input type="checkbox" id="rememberMe" name="rememberMe">
            <label for="rememberMe">Remember me</label><br>
            <a href="recover.html">Lost your password?</a><br>
            <a href="register.html">Don't have an account?</a><br>
        </form>
    </div>
</div>
<script>
    var clearInfoDiv = function () {
        var info = document.getElementById("msg");
        if (info.classList.contains("message-error"))
            info.classList.remove("message-error");
        if (info.classList.contains("message-warning"))
            info.classList.remove("message-warning");
        if (info.classList.contains("message-success"))
            info.classList.remove("message-success");

        if (!info.classList.contains("message"))
            info.classList.add("message");

        info.innerText = "";

    };
    var errorInfo = function (msg) {
        var info = document.getElementById("msg");
        clearInfoDiv();

        info.classList.add("message-error");
        info.innerHTML = msg;
    };
    var warningInfo = function (msg) {
        var info = document.getElementById("msg");
        clearInfoDiv();

        info.classList.add("message-warning");
        info.innerText = msg;
    };
    var successInfo = function (msg) {
        var info = document.getElementById("msg");
        clearInfoDiv();

        info.classList.add("message-success");
        info.innerText = msg;
    };

    var ajaxReq = function () {
        if (this.readyState !== 4) return;
        if (this.status !== 200) {
            errorInfo("Bad server response code.");
            return;
        }

        var resObj = JSON.parse(this.responseText);
        console.log(resObj);
        //Todo:redirect to profile
    };

    document.getElementById('login').addEventListener("submit", function (event) {
        event.preventDefault();
        var reqObj = {};

        var email = document.getElementById("email");
        var passw = document.getElementById("password");
        var remember = document.getElementById('rememberMe');
        var info = document.getElementById("msg");

        if (info === undefined) return;

        if (remember === undefined || email === undefined || passw === undefined) {
            errorInfo("Something went wrong. Reload the page.");
            return;
        }

        reqObj.email = email.value;
        reqObj.password = passw.value;
        reqObj.remember = remember.checked;

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = ajaxReq;

        xhttp.open("POST", "/api/login", true);
        xhttp.setRequestHeader("Content-type", "application/json");
        // console.log(JSON.stringify(reqObj));////////////////////////////////////////
        xhttp.send(JSON.stringify(reqObj));
    });
</script>
</body>
</html>
