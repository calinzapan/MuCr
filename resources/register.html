<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Register - Music Collector</title>
    <link rel="icon" type="image/png" sizes="192x192" href="./img/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css"
          href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/css/forms.css">


</head>
<body style="background-image: url('/img/background3.jpg');">
<div class="overlay"></div>
<div class="shadow-overlay"></div>
<div class="header">
    <div class="formbox">
        <div class="logo">
            <a href="index"><img src="/img/logo.png" alt="Homepage"></a>
        </div>
        <form id="registration">
            <p>First Name</p>
            <input id="firstname" type="text" placeholder="Enter First Name" required><br>
            <p>Last Name</p>
            <input id="lastname" type="text" placeholder="Enter Last Name" required><br>
            <p>Email Address</p>
            <input id="email" type="email" placeholder="Enter Email Address" required><br>
            <p>Password</p>
            <input id="password" type="password" placeholder="Enter Password" required><br><br>

            <div id="msg" class="message"> Allow only ascii characters to be sent.</div>
            <input type="submit" value="Register">
            <div id="info">Already have an account? <a href="login">Log in</a></div>
        </form>
    </div>
</div>
<div id="success">
    <h1>You are registered. Go <a href="/">home</a></h1>
</div>

<script>
    var clearInfoDiv = function () {
        var info = document.getElementById("msg");
        if (info.classList.contains("message-error"))
            info.classList.remove("message-error");
        if (info.classList.contains("message-warning"))
            info.classList.remove("message-warning");
        if (info.classList.contains("message-success"))
            info.classList.remove("message-success");

        if (!info.classList.contains("message"))
            info.classList.add("message");

        info.innerText = "";

    };
    var errorInfo = function (msg) {
        var info = document.getElementById("msg");
        clearInfoDiv();

        info.classList.add("message-error");
        info.innerHTML = msg;
    };
    var warningInfo = function (msg) {
        var info = document.getElementById("msg");
        clearInfoDiv();

        info.classList.add("message-warning");
        info.innerText = msg;
    };
    var successInfo = function (msg) {
        var info = document.getElementById("msg");
        clearInfoDiv();

        info.classList.add("message-success");
        info.innerText = msg;
    };

    var ajaxReq = function () {
        if (this.readyState !== 4) return;
        if (this.status !== 200) {
            errorInfo("Bad server response code.");
            return;
        }

        var resObj = JSON.parse(this.responseText);
        if (resObj === undefined || resObj.code === undefined || resObj.msg === undefined) {
            errorInfo("Invalid server response.");
            return;
        }

        if (resObj.code === 0) {
            let _form = document.getElementById('registration');
            if (_form) _form.reset();
            let layer = document.getElementById('success');
            if (layer)
                layer.style.display = 'block';
        }
        else {
            warningInfo(resObj.msg);
        }
    };

    document.getElementById("registration").addEventListener("submit", function (event) {
        event.preventDefault();
        console.log("here");
        var reqObj = {};

        var fname = document.getElementById("firstname");
        var lname = document.getElementById("lastname");
        var email = document.getElementById("email");
        var passw = document.getElementById("password");

        var info = document.getElementById("msg");

        if (info === undefined) return;

        if (fname === undefined || lname === undefined || email === undefined || passw === undefined) {
            errorInfo("Something went wrong. Reload the page.");
            return;
        }

        reqObj.firstname = fname.value;
        reqObj.lastname = lname.value;
        reqObj.email = email.value;
        reqObj.password = passw.value;

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = ajaxReq;

        xhttp.open("POST", "/api/register", true);
        xhttp.setRequestHeader("Content-type", "application/json");
        console.log(JSON.stringify(reqObj));////////////////////////////////////////
        xhttp.send(JSON.stringify(reqObj));
    });
</script>
</body>
</html>
